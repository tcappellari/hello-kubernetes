Hello
=================================================

This project is configured to run the Hello project, generated by the lagom/lagom-scala.g8 template,
on Kubernetes and is based on the following guide:
https://developer.lightbend.com/guides/lagom-kubernetes-k8s-deploy-microservices/

The aim of the project is to supply a basic project that run a Lagom-based system to Kubernetes.


Setting up Minikube Kubernetes Cluster
-------------------------------------------------

The command below will reset your Minikube and ensure that kubectl and docker can communicate with it.

```
(minikube delete || true) &>/dev/null && \
minikube start --memory 8192 && \
eval $(minikube docker-env)
```


Deploy Cassandra
-------------------------------------------------
The command below will create the resources, wait for Cassandra to start up, and show you its status.

```
kubectl create -f deploy/kubernetes/resources/cassandra && \
deploy/kubernetes/scripts/kubectl-wait-for-pods && \
kubectl exec cassandra-0 -- nodetool status
```

Deploy Kafka (and Zookeeper)
-------------------------------------------------
The command below will create the resources, wait for Zookeeper and then Kafka to start up, and show you its status.

Zookeeper
```
kubectl create -f deploy/kubernetes/resources/zookeeper && \
deploy/kubernetes/scripts/kubectl-wait-for-pods && \
kubectl get all
```

Kafka
```
kubectl create -f deploy/kubernetes/resources/kafka && \
deploy/kubernetes/scripts/kubectl-wait-for-pods && \
kubectl get all
```


Build Hello Docker images
-------------------------------------------------

The command below will build Hello and create the Docker images using sbt.

`sbt -DbuildTarget=kubernetes clean docker:publishLocal`


Deploy Hello
-------------------------------------------------

The command below will create the resources, wait for all of them to startup, and show you the cluster’s pod status.

```
kubectl create -f deploy/kubernetes/resources/hello && \
deploy/kubernetes/scripts/kubectl-wait-for-pods && \
kubectl get all
```


Deploy NGINX
-------------------------------------------------

The command below will create Ingress resouces and NGINX to load the application resources, wait for all of them to startup, and show you the cluster’s pod status.

```
kubectl create -f deploy/kubernetes/resources/nginx && \
deploy/kubernetes/scripts/kubectl-wait-for-pods && \
kubectl get pods
```


Verify deployment
-------------------------------------------------

Use the following commands to test your deployment.

Post Hi message

`curl -H "Content-Type: application/json" -X POST -d '{"message":"Hi"}' $(minikube service --url nginx-ingress | head -n 1)/api/hello/Alice`

Say Hi to Alice

`curl $(minikube service --url nginx-ingress | head -n 1)/api/hello/Alice`



